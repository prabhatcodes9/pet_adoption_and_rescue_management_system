<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pet Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_adopt.css') }}">
    <script>
        // Optional: Use JS to remove request card immediately after submit
        function removeRequestCard(event, form) {
            event.preventDefault();
            fetch(form.action, {
                method: 'POST',
                body: new FormData(form)
            }).then(() => {
                form.closest('.request-card').remove();
            });
        }
    </script>
</head>
<body>
<div class="container">
    <!-- Dashboard Header -->
    <header class="dashboard-header">
        <h1>Pet Admin Dashboard</h1>
        <p>Manage adoption requests</p>
        <a href="{{ url_for('admin_dashboard') }}" class="back-btn">‚Üê Back to Dashboard</a>
    </header>

    <!-- Pets Grid -->
    <div class="pet-grid">
        {% if pets %}
            {% for pet in pets %}
                <div class="pet-card">
                    <img src="{{ url_for('static', filename='uploads/' + (pet.image or 'default.png')) }}" alt="{{ pet.pet_name }}">
                    <h3>{{ pet.pet_name }}</h3>
                    <p><strong>Type:</strong> {{ pet.pet_type }}</p>
                    <p><strong>Breed:</strong> {{ pet.breed or 'N/A' }}</p>
                    <p><strong>Age:</strong> {{ pet.age or 'N/A' }}</p>
                    <p><strong>Gender:</strong> {{ pet.gender or 'N/A' }}</p>
                    <p><strong>Description:</strong> {{ pet.description or 'N/A' }}</p>
                    <p><strong>Location:</strong> {{ pet.location or 'N/A' }}</p>
                    <p><strong>Mobile:</strong> {{ pet.mobile or 'N/A' }}</p>
                    
                    <!-- Pet Status Badge -->
                    <p><strong>Pet Status:</strong>
                        {% if pet.status == 'pending' %}
                            <span class="status-badge pending">Pending Approval</span>
                        {% elif pet.status == 'adopted' %}
                            <span class="status-badge adopted">Adopted</span>
                        {% elif pet.status == 'rejected' %}
                            <span class="status-badge rejected">Rejected</span>
                        {% endif %}
                    </p>

                    <!-- Adoption Requests -->
                    <div class="requests-section">
                        <h4>Adoption Requests</h4>
                        {% if requests %}
                            {% for req, pet_name, pet_type, breed, user_name, user_email in requests %}
                        <div class="request-card">
                            <p><strong>Pet:</strong> {{ pet_name }} ({{ pet_type }} - {{ breed or 'N/A' }})</p>
                            <p><strong>Requested By:</strong> {{ user_name }} ({{ user_email }})</p>
                            <p><strong>Reason:</strong> {{ req.reason }}</p>
                            <p><strong>Contact:</strong> {{ req.mobile }}</p>
                            <p><strong>Address:</strong> {{ req.address }}</p>

                                    {% if req.status == 'pending' %}
                                        <form method="POST" action="{{ url_for('update_adopt_request', req_id=req.id, action='approve') }}" style="display:inline;" onsubmit="removeRequestCard(event, this);">
                                            <button type="submit" class="approve-btn">‚úÖ Approve</button>
                                        </form>
                                        <form method="POST" action="{{ url_for('update_adopt_request', req_id=req.id, action='reject') }}" style="display:inline;" onsubmit="removeRequestCard(event, this);">
                                            <button type="submit" class="reject-btn">‚ùå Reject</button>
                                        </form>
                                    {% else %}
                                        <p><strong>Status:</strong>
                                            {% if req.status == 'approved' %}<span style="color:green;">Adopted</span>
                                            {% elif req.status == 'rejected' %}<span style="color:red;">Rejected</span>
                                            {% endif %}
                                        </p>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        {% else %}
                            <p>No adoption requests for this pet yet.</p>
                        {% endif %}
                    </div>

                    <!-- Edit/Delete Pet -->
                    <div class="pet-actions">
                        <a href="{{ url_for('edit_pet', pet_id=pet.id) }}" class="edit-btn">‚úèÔ∏è Edit</a>
                        <form action="{{ url_for('delete_adopt_pet', pet_id=pet.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this pet?');">
                            <button type="submit" class="delete-btn">üóëÔ∏è Delete</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p>No adoptable pets found.</p>
        {% endif %}
    </div>
</div>
</body>
</html>