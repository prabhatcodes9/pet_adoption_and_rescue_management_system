<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pet Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_adopt.css') }}">
    <script>
    function removeRequestCard(event, form) {
        event.preventDefault();

        // Disable both buttons inside the same request-card immediately
        const buttons = form.closest('.request-card').querySelectorAll('button');
        buttons.forEach(btn => {
            btn.disabled = true;
            btn.style.opacity = '0.6';
            btn.style.cursor = 'not-allowed';
        });

        fetch(form.action, {
            method: 'POST',
            body: new FormData(form)
        })
        .then(() => {
            // Remove request card after server confirms
            form.closest('.request-card').remove();
        })
        .catch(() => {
            // If fetch fails, re-enable buttons
            buttons.forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
            });
        });
    }

    function showSection(section) {
      const sections = document.querySelectorAll('.pet-grid');
      sections.forEach(s => s.classList.remove('show'));
      document.getElementById(section).classList.add('show');

      const tabs = document.querySelectorAll('.status-card');
      tabs.forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-section="${section}"]`).classList.add('active');
    }

    function showPetDetails(pet) {
      const modal = document.getElementById('petDetailModal');
      modal.querySelector('.modal-content').innerHTML = `
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2>${pet.pet_name}</h2>
        <div class="tag-row">
          <span class="tag type">${pet.pet_type}</span>
          <span class="tag breed">${pet.breed || 'N/A'}</span>
          <span class="tag status ${pet.status}">${pet.status}</span>
        </div>
        <p><strong>Age:</strong> ${pet.age || 'N/A'}</p>
        <p><strong>Gender:</strong> ${pet.gender || 'N/A'}</p>
        <p><strong>Description:</strong> ${pet.description || 'N/A'}</p>
        <p><strong>Location:</strong> ${pet.location || 'N/A'}</p>
        <p><strong>Mobile:</strong> ${pet.mobile || 'N/A'}</p>
      `;
      modal.style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('petDetailModal').style.display = 'none';
    }

    document.addEventListener('DOMContentLoaded', () => showSection('pending'));
</script>
    
</head>
<body>
<div class="container">
    <header class="dashboard-header">
        <h1>Pet Admin Dashboard</h1>
        <p>Manage adoption requests</p>
        <a href="{{ url_for('admin_dashboard') }}" class="back-btn">‚Üê Back to Dashboard</a>
    </header>

    <!-- Status Tabs -->
    <div class="status-cards">
        <div class="status-card active" data-section="pending" onclick="showSection('pending')">
            <h3>Pending</h3>
            <span>{{ pending_count }}</span>
        </div>
        <div class="status-card" data-section="adopted" onclick="showSection('adopted')">
            <h3>Adopted</h3>
            <span>{{ adopted_count }}</span>
        </div>
    </div>

<!-- Pending Pets -->
    <div class="pet-grid" id="pending">
      {% set pending_pets = pet_data | selectattr("pet.status", "equalto", "pending") | list %}
      {% if pending_pets %}
        {% for item in pending_pets %}
          <div class="pet-card">
            <div class="pet-image">
                <img src="{{ url_for('static', filename='uploads/' + (item.pet.image or 'default.png')) }}" alt="{{ item.pet.pet_name }}">
            </div>
            <h3>{{ item.pet.pet_name }}</h3>

            <div class="tags">
              <span class="tag type">{{ item.pet.pet_type }}</span>
              <span class="tag breed">{{ item.pet.breed or 'N/A' }}</span>
              <span class="tag status pending">Adoptable</span>
            </div>

            <div class="pet-details">
                <p><strong>Details:</strong>{{ item.pet.description or 'N/A' }}</p>
                <p><strong>Location:</strong>{{ item.pet.location or 'N/A' }}</p>
            </div>

            <div class="card-buttons">
              <button class="view-btn" onclick='showPetDetails({ 
                "pet_name": "{{ item.pet.pet_name }}",
                "pet_type": "{{ item.pet.pet_type }}",
                "breed": "{{ item.pet.breed }}",
                "age": "{{ item.pet.age }}",
                "gender": "{{ item.pet.gender }}",
                "description": "{{ item.pet.description }}",
                "location": "{{ item.pet.location }}",
                "mobile": "{{ item.pet.mobile }}",
                "status": "pending"
              })'>View</button>

              <form action="{{ url_for('delete_adopt_pet', pet_id=item.pet.id) }}" method="POST" onsubmit="return confirm('Delete this pet?');">
                <button type="submit" class="delete-btn">Delete</button>
              </form>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>No pending pets found.</p>
      {% endif %}
    </div>

    <!-- Adopted Pets -->
    <div class="pet-grid" id="adopted">
      {% set adopted_pets = pet_data | selectattr("pet.status", "equalto", "adopted") | list %}
      {% if adopted_pets %}
        {% for item in adopted_pets %}
          <div class="pet-card">
            <div class="pet-image">
                <img src="{{ url_for('static', filename='uploads/' + (item.pet.image or 'default.png')) }}" alt="{{ item.pet.pet_name }}">
            </div>
            <h3>{{ item.pet.pet_name }}</h3>

            <div class="tag-row">
              <span class="tag type">{{ item.pet.pet_type }}</span>
              <span class="tag breed">{{ item.pet.breed or 'N/A' }}</span>
              <span class="tag status adopted">Adopted</span>
            </div>

            <div class="pet-details">
                <p><strong>Details:</strong>{{ item.pet.description or 'N/A' }}</p>
                <p><strong>Location:</strong> {{ item.pet.location or 'N/A' }}</p>
            </div>

            <div class="card-buttons">
              <button class="view-btn" onclick='showPetDetails({ 
                "pet_name": "{{ item.pet.pet_name }}",
                "pet_type": "{{ item.pet.pet_type }}",
                "breed": "{{ item.pet.breed }}",
                "age": "{{ item.pet.age }}",
                "gender": "{{ item.pet.gender }}",
                "description": "{{ item.pet.description }}",
                "location": "{{ item.pet.location }}",
                "mobile": "{{ item.pet.mobile }}",
                "status": "adopted"
              })'>View</button>

              <form action="{{ url_for('delete_adopt_pet', pet_id=item.pet.id) }}" method="POST" onsubmit="return confirm('Delete this pet?');">
                <button type="submit" class="delete-btn">Delete</button>
              </form>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>No adopted pets found.</p>
      {% endif %}
    </div>
  </div>

  <!-- Pet Detail Modal -->
  <div id="petDetailModal" class="modal">
    <div class="modal-content"></div>
  </div>
</body>
</html>